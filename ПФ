Методика разработки макетов печатных форм, автоматически подключемых к механизму хранения пользовательских макетов



Какой бы макет Вы не разработали - надо обязательно добавить к имени макета один из вариантов буквосочетаний:


ПФ_MXL (соответствует макету табличного документа);
ПФ_DOC (соответствует макету Microsoft Word до 2007);
ПФ_DOCX (соответствует макету Microsoft Word );
ПФ_ODT (соответствует макету OpenOffice.org Writer).



Методика подготовки объекта для работы с печатными формами

1. Подготовить форму объекта:


1.1 В обработчике «ПриСозданииНаСервере» должен вызывался стандартный алгоритм формирования подменю формы


&НаСервере

Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

…

// СтандартныеПодсистемы.ПодключаемыеКоманды

ПодключаемыеКоманды.ПриСозданииНаСервере(ЭтотОбъект);

// Конец СтандартныеПодсистемы.ПодключаемыеКоманды

…

КонецПроцедуры




1.2 Должен присутствовать блок процедур, обслуживающих создаваемые команды (именно с таким текстом):

// СтандартныеПодсистемы.ПодключаемыеКоманды

&НаКлиенте

Процедура Подключаемый_ВыполнитьКоманду(Команда)

ПодключаемыеКомандыКлиент.ВыполнитьКоманду(ЭтотОбъект, Команда, Объект);

КонецПроцедуры


&НаСервере

Процедура Подключаемый_ВыполнитьКомандуНаСервере(Контекст, Результат)

ПодключаемыеКоманды.ВыполнитьКоманду(ЭтотОбъект, Контекст, Объект, Результат);

КонецПроцедуры


&НаКлиенте

Процедура Подключаемый_ОбновитьКоманды()

ПодключаемыеКомандыКлиентСервер.ОбновитьКоманды(ЭтотОбъект, Объект);

КонецПроцедуры

// Конец СтандартныеПодсистемы.ПодключаемыеКоманды



1.3 В обработчике «ПриЧтенииНаСервере» должен вызывался стандартный алгоритм обновления подменю формы



&НаСервере

Процедура ПриЧтенииНаСервере(ТекущийОбъект)

…

// СтандартныеПодсистемы.ПодключаемыеКоманды

ПодключаемыеКомандыКлиентСервер.ОбновитьКоманды(ЭтотОбъект, Объект);

// Конец СтандартныеПодсистемы.ПодключаемыеКоманды

…


КонецПроцедуры

1.4 В обработчике «ПриОткрытии» должен вызывался стандартный алгоритм обновления подменю формы

&НаКлиенте

Процедура ПриОткрытии(Отказ)

…

// СтандартныеПодсистемы.ПодключаемыеКоманды

ПодключаемыеКомандыКлиент.НачатьОбновлениеКоманд(ЭтотОбъект);

// Конец СтандартныеПодсистемы.ПодключаемыеКоманды

…

КонецПроцедуры



(Как Вы верно уже догадались, программный код большинства вышеперечисленных пунктов «дешевле» скопировать у какой-нибудь уже подготовленной в типовой конфигурации формы объекта. Ибо – все стандартно.)



1.5 Желательно создать реквизит формы «ПараметрыПодключаемыхКоманд» с типом – «Произвольный» (наличие такого готового реквизита несколько ускоряет открытие формы).



1.6 Желательно добавить в командную панель подменю «ПодменюПечать» с установленными свойствами, как на картинке ниже:





2. Подготовить форму списка:


2.1 В обработчике «ПриСозданииНаСервере» должен вызывался стандартный алгоритм формирования подменю формы


&НаСервере

Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

…

// СтандартныеПодсистемы.ПодключаемыеКоманды

ПодключаемыеКоманды.ПриСозданииНаСервере(ЭтотОбъект);

// Конец СтандартныеПодсистемы.ПодключаемыеКоманды

…

КонецПроцедуры




2.2 Должен присутствовать блок процедур, обслуживающих создаваемые команды (именно с таким текстом):

// СтандартныеПодсистемы.ПодключаемыеКоманды

&НаКлиенте

Процедура Подключаемый_ВыполнитьКоманду(Команда)

ПодключаемыеКомандыКлиент.ВыполнитьКоманду(ЭтотОбъект, Команда, Элементы.Список);

КонецПроцедуры


&НаСервере

Процедура Подключаемый_ВыполнитьКомандуНаСервере(Контекст, Результат)

ПодключаемыеКоманды.ВыполнитьКоманду(ЭтотОбъект, Контекст, Элементы.Список, Результат);

КонецПроцедуры


&НаКлиенте

Процедура Подключаемый_ОбновитьКоманды()

ПодключаемыеКомандыКлиентСервер.ОбновитьКоманды(ЭтотОбъект, Элементы.Список);

КонецПроцедуры

// Конец СтандартныеПодсистемы.ПодключаемыеКоманды


2.3 В обработчике «СписокПриАктивизацииСтроки» должен вызывался стандартный алгоритм обновления подменю формы



&НаКлиенте

Процедура СписокПриАктивизацииСтроки(Элемент)

…

// СтандартныеПодсистемы.ПодключаемыеКоманды

ПодключаемыеКомандыКлиент.НачатьОбновлениеКоманд(ЭтотОбъект);

// Конец СтандартныеПодсистемы.ПодключаемыеКоманды

…

КонецПроцедуры



(Как Вы верно уже догадались, программный код большинства вышеперечисленных пунктов «дешевле» скопировать у какой-нибудь уже подготовленной в типовой конфигурации формы списка. Ибо – все стандартно.)

2.4 В форме списка обязательно проверить наличие флажка "Использовать всегда" у поля "Ссылка" динамического списка:


2.5 Желательно создать реквизит формы «ПараметрыПодключаемыхКоманд» с типом – «Произвольный» (наличие такого готового реквизита несколько ускоряет открытие формы):



2.6 Желательно добавить в командную панель подменю «ПодменюПечать» с установленными свойствами, как на картинке ниже:



3. В модуле менеджера объекта


3.1 Должна быть заготовка под процедуру «ДобавитьКомандыПечати»





Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт



КонецПроцедуры


3.2 Должна быть заготовка под процедуру «Печать»


Процедура Печать(МассивОбъектов, ПараметрыПечати, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт



КонецПроцедуры

